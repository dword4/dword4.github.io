<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>dword4</title>

    <link rel="stylesheet" href="https://dword4.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" href="https://dword4.github.io/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="https://dword4.github.io/theme/css/style.css" />
    <link rel="stylesheet" href="https://dword4.github.io/theme/css/pygments.css" />	
    <script src="https://dword4.github.io/theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->
    <!-- counter.dev analytics -->
    <script src="https://cdn.counter.dev/script.js" data-id="73758749-b152-4acd-80e7-11da6c5a7f74" data-utcoffset="-5"></script>
    <!-- end counter.dev analyrics -->

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="https://dword4.github.io">dword4</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

            <li><a href="https://dword4.github.io/pages/about-me.html" class="button secondary small">About&nbsp;Me</a></li>
    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="https://dword4.github.io/api-results-loop.html"><h3 class="article-title">Looping Unknown <span class="caps">API</span>&nbsp;Results</h3></a>
<h6 class="subheader" title="2025-12-12T00:00:00-05:00">Fri 12 December 2025
</h6>


<p>ome APIs do not tell you how many results you have to work with, so you end up blindly looping until a failure which is not generally&nbsp;ideal. </p>
<p><code>api/v1/projects</code> </p>
<p>Take the endpoint above, lets say it takes two possible&nbsp;parameters</p>
<p><code>size</code> which represents the number of results returned by the current call
<code>offset</code> which means where in the unknown list of projects we want to start the retrieval of the <strong>size</strong> number of&nbsp;results</p>
<p>So we would get a bunch of calls like&nbsp;this</p>
<div class="highlight"><pre><span></span><code>api/v1/projects?size=20&amp;offset=0
api/v1/projects?size=20&amp;offset=20
api/v1/projects?size=20&amp;offset=40
...
</code></pre></div>

<p>But we must remember we don&#8217;t <em>know</em> how many of these calls we may need to make without cheating and looking at say the web interface this <span class="caps">API</span> is used to build. To help simulate this experience I threw together a very rudimentery script to imitate the idea of an unknown sized list we can use to work&nbsp;against</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>

<span class="n">MAX</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">SIZE</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">API</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">MAX</span><span class="p">):</span>
<span class="n">API</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Project </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rulesets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Ruleset </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))],</span>
    <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="p">})</span>
</code></pre></div>

<p>So this gives us a randomized list called <strong><span class="caps">API</span></strong> which we can work against to figure out a sensible looping strategy. Since we don&#8217;t know the size of <strong><span class="caps">API</span></strong> in theory, we cant use a for loop without some rather complex conditions, so lets try something much&nbsp;simpler.</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># loop contents</span>
</code></pre></div>

<p>While loops are ideal for this since we can just do a True/False loop because we either get data we can use from the <span class="caps">API</span> or we don&#8217;t, there is no other potential situation (minus obvious outliers like ratelimits, authentication failures, etc) we would occur that the loop needs to&nbsp;handle</p>
<p>To facilitate this and make things more readable we need a function that will grab a chunk of results from <strong><span class="caps">API</span></strong> and return them, that way we can separate out logic a&nbsp;bit.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grab_projects</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

<span class="n">url_projects</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://some.api.host/api/v1/projects?limit=</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching projects from </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="si">}</span><span class="s2">, URL: </span><span class="si">{</span><span class="n">url_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">API</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

<span class="k">return</span> <span class="n">subset</span>
</code></pre></div>

<p>So now we have a function that takes two inputs for size and offset, then returns us that chunk of results. If you were actually making <span class="caps">API</span> calls here is where you would slap some requests work and any error handling you may&nbsp;want.</p>
<p>With that in place we can do the meat and potatoes of this loop, which looks something like&nbsp;this</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">set_of_projects</span> <span class="o">=</span> <span class="n">grab_projects</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">SIZE</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">set_of_projects</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">set_of_projects</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">+=</span> <span class="n">SIZE</span>
</code></pre></div>

<p>This loops until there is a failure to set the variable <strong>set_of_projects</strong> from the return from grab_projects() so we don&#8217;t know how many times it will loop, only that there will eventually be and end and we stop looping when thats hit. In order to allow us to collect all of the information we have a list called <strong>batches</strong> to which we append <strong>set_of_projects</strong> on each iteration of the loop, then after we are done we can flatten it into something we can use elsewhere by using a list&nbsp;comprehension</p>
<div class="highlight"><pre><span></span><code><span class="c1"># flatten the list of lists</span>
<span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
</code></pre></div>

<p>When put together it looks like&nbsp;this </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>

<span class="n">MAX</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">SIZE</span> <span class="o">=</span> <span class="mi">20</span>



<span class="n">API</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">MAX</span><span class="p">):</span>
    <span class="n">API</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Project </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rulesets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Ruleset </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))],</span>
        <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">grab_projects</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">url_projects</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://some.api.host/api/v1/projects?limit=</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching projects from </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="si">}</span><span class="s2">, URL: </span><span class="si">{</span><span class="n">url_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">API</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">subset</span>



<span class="n">batches</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">all_projects</span> <span class="o">=</span> <span class="p">[]</span>



<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">set_of_projects</span> <span class="o">=</span> <span class="n">grab_projects</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">SIZE</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">set_of_projects</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">set_of_projects</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">+=</span> <span class="n">SIZE</span>



<span class="c1"># flatten the list of lists</span>

<span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>


<span class="c1"># output from all_projects </span>
<span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">all_projects</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">project</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">project</span><span class="p">[</span><span class="s1">&#39;rulesets&#39;</span><span class="p">],</span> <span class="n">project</span><span class="p">[</span><span class="s1">&#39;rules&#39;</span><span class="p">])</span>
</code></pre></div>

<p>Now this at least gets you the results to work with and provides me a chance to show where you could go from here. If the <span class="caps">API</span> is particularly slow (which the one I was working with at the moment) then you don&#8217;t want to wait forever for this loop to do its thing. From here it would be worthwhile to make some changes to the script to define a temporary <span class="caps">MAX</span> of like say 200 if you are taking chunks of 20 results, run the code and benchmark it to see how long it takes for the 10 calls to return their&nbsp;results. </p>
<p>Armed with some benchmark information (in my case it was 2 minutes to pull 430ish projects in chunks of 20, avg of like 5 seconds per call) its possible to apply some threading or other similar methodology to get the data set&nbsp;faster</p><p class="subheader">Category: <a href="https://dword4.github.io/category/programming.html">programming</a>

</p>



            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="https://dword4.github.io/aws-terraform-bug.html"><h3 class="article-title">Terraform <span class="amp">&amp;</span> <span class="caps">AWS</span>&nbsp;Bug</h3></a>
<h6 class="subheader" title="2025-07-14T00:00:00-04:00">Mon 14 July 2025
</h6>


<p>Detailing a long-standing bug with Terraform and <span class="caps">AWS</span> regarding handling of deletion of&nbsp;resources</p><p class="subheader">Category: <a href="https://dword4.github.io/category/programming.html">programming</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/aws-terraform-bug.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/ci-headaches.html"><h3 class="article-title"><span class="caps">CI</span>&nbsp;Headaches</h3></a>
<h6 class="subheader" title="2025-03-17T00:00:00-04:00">Mon 17 March 2025
</h6>


<p>The longer I am in this space the more I find myself noticing shortcimings of software that just seems obvious to me. Recently the target of a lot of that feeling has beocme Gitlab which I use on a daily basis for work.  Particularly a lot of the things around their <span class="caps">CI</span>/<span class="caps">CD</span> Pipelines has lead to quite a bit of frustration and&nbsp;annoyance.</p><p class="subheader">Category: <a href="https://dword4.github.io/category/devops.html">devops</a>

    Tagged: 
    <a href="https://dword4.github.io/tag/cicd.html">CI/CD </a>
    <a href="https://dword4.github.io/tag/gitlab.html">Gitlab </a>
    <a href="https://dword4.github.io/tag/devops.html">DevOps </a>
</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/ci-headaches.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/aws-switch-vault-jenkins.html"><h3 class="article-title"><span class="caps">AWS</span> Account Switching with Vault in&nbsp;Jenkins</h3></a>
<h6 class="subheader" title="2023-06-15T00:00:00-04:00">Thu 15 June 2023
</h6>


<p>A workaround for <span class="caps">AWS</span> Account Switching with Vault in&nbsp;Jenkins</p><p class="subheader">Category: <a href="https://dword4.github.io/category/programming.html">programming</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/aws-switch-vault-jenkins.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/optimizing-cicd-pipelines.html"><h3 class="article-title">Optimizing Gitlab <span class="caps">CI</span>/<span class="caps">CD</span>&nbsp;Pipelines</h3></a>
<h6 class="subheader" title="2022-11-29T00:00:00-05:00">Tue 29 November 2022
</h6>


<p>collecting my efforts on making my pipelines more&nbsp;streamlined</p><p class="subheader">Category: <a href="https://dword4.github.io/category/programming.html">programming</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/optimizing-cicd-pipelines.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/updating-again.html"><h3 class="article-title">Updating this&nbsp;again</h3></a>
<h6 class="subheader" title="2022-11-01T00:00:00-04:00">Tue 01 November 2022
</h6>


<p>trying to get back in the habit of regular&nbsp;updates</p><p class="subheader">Category: <a href="https://dword4.github.io/category/thoughts.html">thoughts</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/updating-again.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/taking-back-email-update1.html"><h3 class="article-title">Taking Back Email - Update&nbsp;1</h3></a>
<h6 class="subheader" title="2022-05-01T00:00:00-04:00">Sun 01 May 2022
</h6>


<p>first update to taking back email&nbsp;project</p><p class="subheader">Category: <a href="https://dword4.github.io/category/thoughts.html">thoughts</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/taking-back-email-update1.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/taking-back-email.html"><h3 class="article-title">Taking Back Email - An&nbsp;Overview</h3></a>
<h6 class="subheader" title="2021-12-17T00:00:00-05:00">Fri 17 December 2021
</h6>


<p>a quick overview of how to take back&nbsp;email</p><p class="subheader">Category: <a href="https://dword4.github.io/category/thoughts.html">thoughts</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/taking-back-email.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/sunsetting-hockey-info.html"><h3 class="article-title">Sunsetting a&nbsp;Project</h3></a>
<h6 class="subheader" title="2021-10-13T00:00:00-04:00">Wed 13 October 2021
</h6>


<p>ruminating on the end of a project and the path&nbsp;forward</p><p class="subheader">Category: <a href="https://dword4.github.io/category/thoughts.html">thoughts</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/sunsetting-hockey-info.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="https://dword4.github.io/staircase-programming-challenge.html"><h3 class="article-title">Staircase&nbsp;Challenge</h3></a>
<h6 class="subheader" title="2021-08-27T00:00:00-04:00">Fri 27 August 2021
</h6>


<p>a quick code blurb I wrote for an online&nbsp;challenge</p><p class="subheader">Category: <a href="https://dword4.github.io/category/programming.html">programming</a>

</p>



                <a class="button radius secondary small right" href="https://dword4.github.io/staircase-programming-challenge.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->
<div class="pagination-centered">
<h6 class="subheader">Page 1 of 3</h6>

<p>

        <a href="https://dword4.github.io/index2.html">Next &raquo;</a>
</p>
</div>

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="https://dword4.github.io/archives.html">Archives</a>
            <li><a href="https://dword4.github.io/tags.html">Tags</a>


        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="https://dword4.github.io/category/automation.html">automation</a></li>
            <li><a href="https://dword4.github.io/category/cloud.html">cloud</a></li>
            <li><a href="https://dword4.github.io/category/cloud-aws.html">cloud-aws</a></li>
            <li><a href="https://dword4.github.io/category/devops.html">devops</a></li>
            <li><a href="https://dword4.github.io/category/fixes.html">fixes</a></li>
            <li><a href="https://dword4.github.io/category/general.html">general</a></li>
            <li><a href="https://dword4.github.io/category/homelab.html">Homelab</a></li>
            <li><a href="https://dword4.github.io/category/programming.html">programming</a></li>
            <li><a href="https://dword4.github.io/category/programming-cloud-git.html">programming, cloud, git</a></li>
            <li><a href="https://dword4.github.io/category/projects.html">projects</a></li>
            <li><a href="https://dword4.github.io/category/sysadmin.html">sysadmin</a></li>
            <li><a href="https://dword4.github.io/category/thoughts.html">thoughts</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="https://www.dazedpro.com/">DazedPro</a></li>
            <li><a href="https://mpietruszka.com/">mikep</a></li>
        </ul>
		

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>dword4 by dword4</p>
            </div>
            </div>
    </div>
</footer>